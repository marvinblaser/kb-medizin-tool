<!-- public/reports.html -->

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rapports - KB Medizin Tool</title>
  <link rel="stylesheet" href="/css/tokens.css" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/forms.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/table.css" />
  <link rel="stylesheet" href="/css/pages.css" />
  <link rel="stylesheet" href="/css/utilities.css" />
  <link rel="stylesheet" href="/css/transitions.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header"><h2>KB Medizin</h2></div>
      <nav class="sidebar-nav">
        <a href="/dashboard.html"><i class="fas fa-chart-line"></i><span>Tableau de bord</span></a>
        <a href="/clients.html"><i class="fas fa-users"></i><span>Clients</span></a>
        <a href="/checklists.html"><i class="fas fa-clipboard-check"></i><span>Checklists</span></a>
        <a href="/reports.html" class="active"><i class="fas fa-file-alt"></i><span>Rapports</span></a>
        <a href="/admin.html" id="admin-link" class="hidden"><i class="fas fa-cog"></i><span>Administration</span></a>
      </nav>
      <div class="sidebar-footer">
        <div class="user-info" id="user-info"></div>
        <button class="btn btn-secondary btn-sm" id="logout-btn" style="width: 100%"><i class="fas fa-sign-out-alt"></i>Déconnexion</button>
      </div>
    </aside>

    <main class="main-content">
      <div class="page-header">
        <h1><i class="fas fa-file-alt"></i> Rapports</h1>
        <button class="btn btn-success" id="add-report-btn"><i class="fas fa-plus"></i> Nouveau rapport</button>
      </div>

      <div class="table-controls">
        <div class="table-controls-row">
          <div class="search-box"><input type="text" id="global-search" placeholder="Rechercher un rapport..." /></div>
          <select id="filter-type">
            <option value="">Tous les types</option>
            <option value="Mise en marche">Mise en marche</option>
            <option value="Service d'entretien">Service d'entretien</option>
            <option value="Réparation">Réparation</option>
            <option value="Contrôle">Contrôle</option>
          </select>
          <select id="filter-status">
            <option value="">Tous les statuts</option>
            <option value="draft">Brouillon</option>
            <option value="completed">Complété</option>
            <option value="sent">Envoyé</option>
          </select>
          <button class="btn btn-secondary" id="clear-filters-btn"><i class="fas fa-times"></i> Effacer</button>
        </div>
      </div>

      <div class="table-container">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>N° Rapport</th><th>Type</th><th>Client</th><th>Date</th><th>Intervenants</th><th>Statut</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="reports-tbody">
              <tr><td colspan="7" style="text-align: center; padding: 40px"><i class="fas fa-spinner fa-spin fa-2x"></i><p>Chargement...</p></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="pagination">
        <span class="pagination-info" id="pagination-info"></span>
        <div class="pagination-buttons">
          <button class="btn btn-secondary" id="prev-page"><i class="fas fa-chevron-left"></i> Précédent</button>
          <button class="btn btn-secondary" id="next-page">Suivant <i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </main>
  </div>

  <div class="modal" id="report-modal">
    <div class="modal-content" style="max-width: 1200px">
      <div class="modal-header">
        <h2 id="report-modal-title"><i class="fas fa-file-alt"></i> Nouveau rapport</h2>
        <button class="modal-close" onclick="closeReportModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="report-form">
          <input type="hidden" id="report-id" />

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-clipboard-list"></i> Type de rapport</h3>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label for="report-type">Type de travaux *</label>
                <select id="report-type" required>
                  <option value="">-- Sélectionner --</option>
                  <option value="Mise en marche">Mise en marche</option>
                  <option value="Service d'entretien">Service d'entretien</option>
                  <option value="Montage">Montage</option>
                  <option value="Réparation">Réparation</option>
                  <option value="Contrôle">Contrôle</option>
                  <option value="Instruction">Instruction</option>
                  <option value="Réparation / Garantie">Réparation / Garantie</option>
                  <option value="Première validation">Première validation</option>
                  <option value="Re-validation">Re-validation</option>
                </select>
              </div>
              <div class="form-group">
                <label for="report-status">Statut</label>
                <select id="report-status">
                  <option value="draft">Brouillon</option>
                  <option value="completed">Terminé</option>
                  <option value="sent">Envoyé</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-building"></i> Client</h3>
            <div class="form-group">
               <label for="client-select">Client *</label>
               <select id="client-select" required><option value="">-- Sélectionner --</option></select>
            </div>
            <div class="form-group"><input type="text" id="cabinet-name" placeholder="Nom du cabinet" required /></div>
            <div class="form-group"><input type="text" id="address" placeholder="Adresse" required /></div>
            <div class="form-row">
              <div class="form-group"><input type="text" id="postal-code" placeholder="NPA" /></div>
              <div class="form-group"><input type="text" id="city" placeholder="Ville" required /></div>
            </div>
            <div class="form-group"><input type="text" id="interlocutor" placeholder="Interlocuteur" /></div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-tools"></i> Installation(s)</h3>
            <div class="form-group">
              <label>Cocher pour ajouter au champ texte :</label>
              <div id="client-equipment-list" style="max-height: 150px; overflow-y: auto; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px;">
                <p style="color: #999;">Sélectionnez un client...</p>
              </div>
            </div>
            <div class="form-group">
              <label for="installation-text">Texte affiché sur le rapport :</label>
              <textarea id="installation-text" rows="2" style="width:100%; font-weight:bold;"></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-users"></i> Intervenants</h3>
            <button type="button" class="btn btn-sm btn-primary" id="add-technician-btn" style="margin-bottom: 10px"><i class="fas fa-plus"></i> Ajouter</button>
            <div id="technicians-list"></div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-tasks"></i> Travaux accomplis</h3>
            <button type="button" class="btn btn-sm btn-primary" id="add-work-btn" style="margin-bottom: 10px"><i class="fas fa-plus"></i> Ajouter une ligne</button>
            <div id="work-list"></div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-check-circle"></i> Tests STK</h3>
            <button type="button" class="btn btn-sm btn-primary" id="add-stk-test-btn" style="margin-bottom: 10px"><i class="fas fa-plus"></i> Ajouter un test</button>
            <div id="stk-tests-list"></div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-toolbox"></i> Matériel utilisé</h3>
            <button type="button" class="btn btn-sm btn-primary" id="add-material-btn" style="margin-bottom: 10px"><i class="fas fa-plus"></i> Ajouter matériel</button>
            <div id="materials-list"></div>
            <div style="text-align: right; margin-top: 10px; font-weight: bold;">
              Total Matériel: <span id="materials-total">0.00</span> CHF
            </div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-car"></i> Frais de déplacement</h3>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label>Ville de départ</label>
                <input type="text" id="travel-city" placeholder="ex: Wil" />
              </div>
              <div class="form-group" style="width: 100px;">
                <label>Canton</label>
                <select id="travel-canton">
                  <option value="">--</option>
                  <option value="AG">AG</option><option value="AI">AI</option><option value="AR">AR</option>
                  <option value="BE">BE</option><option value="BL">BL</option><option value="BS">BS</option>
                  <option value="FR">FR</option><option value="GE">GE</option><option value="GL">GL</option>
                  <option value="GR">GR</option><option value="JU">JU</option><option value="LU">LU</option>
                  <option value="NE">NE</option><option value="NW">NW</option><option value="OW">OW</option>
                  <option value="SG">SG</option><option value="SH">SH</option><option value="SO">SO</option>
                  <option value="SZ">SZ</option><option value="TG">TG</option><option value="TI">TI</option>
                  <option value="UR">UR</option><option value="VD">VD</option><option value="VS">VS</option>
                  <option value="ZG">ZG</option><option value="ZH">ZH</option>
                </select>
              </div>
              <div class="form-group">
                <label>Prix (CHF)</label>
                <input type="number" id="travel-costs" step="0.01" min="0" />
              </div>
              <div class="form-group" style="padding-top: 25px;">
                <label><input type="checkbox" id="travel-incl" /> Inclus</label>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-comment"></i> Commentaires</h3>
            <textarea id="remarks" rows="3"></textarea>
          </div>

          <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-signature"></i> Signature Technicien</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Date</label>
                <input type="date" id="tech-signature-date" />
              </div>
              <div class="form-group">
                <label>Initiales</label>
                <input type="text" id="tech-signature" maxlength="10" />
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeReportModal()">Annuler</button>
        <button class="btn btn-success" id="save-report-btn">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-modal">
    <div class="modal-content" style="max-width: 400px">
      <div class="modal-header">
        <h2>Confirmer suppression</h2>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Supprimer le rapport <strong id="delete-report-number"></strong> ?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancel-delete-btn">Annuler</button>
        <button class="btn btn-danger" id="confirm-delete-btn">Supprimer</button>
      </div>
    </div>
  </div>

  <div id="notification-container" class="notification-container"></div>
  <script src="/js/reports.js"></script>
</body>
</html>